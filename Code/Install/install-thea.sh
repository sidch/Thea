#!/bin/bash

################################################################################################################################
# Initialize variables
################################################################################################################################

NUM_PROCS=-j2
SCRIPT_DIR=`dirname "$0"`
BASE_DIR="`perl -e 'use Cwd "abs_path";print abs_path(shift)' "$SCRIPT_DIR"`"
INSTALL_DIR="${BASE_DIR}"
HOST_OS=`uname -s`


################################################################################################################################
# The help message
################################################################################################################################

function show_help {
    echo
    echo "Usage: $0 [-j<num-procs>] [--prefix <prefix-path>]"
    echo
}


################################################################################################################################
# Parse command-line arguments
################################################################################################################################

until [ -z "$1" ]  # until all parameters used up
do
  case "$1" in
      -j* ) NUM_PROCS="$1" ;;
      --prefix )
          shift
          INSTALL_DIR="$1"
          ;;
      --help )
          show_help
          exit
          ;;
  esac
  shift
done


################################################################################################################################
# Notify the user about the installation directory
################################################################################################################################

echo "Installing Thea to $INSTALL_DIR"


################################################################################################################################
# Ensure target directories exist
################################################################################################################################

mkdir -p "${INSTALL_DIR}/bin" "${INSTALL_DIR}/include" "${INSTALL_DIR}/lib" "${INSTALL_DIR}/share" "${INSTALL_DIR}/man"


################################################################################################################################
# Install Thea
################################################################################################################################

echo "Installing Thea..."
cd "${BASE_DIR}/../Build"
cmake -DTHEA_INSTALLATIONS_ROOT="${INSTALL_DIR}" -DCMAKE_INSTALL_PREFIX="${INSTALL_DIR}" .
make $NUM_PROCS install
cd "${BASE_DIR}"


################################################################################################################################
# Finish
################################################################################################################################

echo "Installation complete"
